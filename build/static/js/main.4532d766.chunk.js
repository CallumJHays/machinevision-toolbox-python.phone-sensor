(this["webpackJsonpmvt-phonesensor-app"]=this["webpackJsonpmvt-phonesensor-app"]||[]).push([[0],{54:function(e,t,n){"use strict";n.r(t);var i=n(3),a=n(0),s=n(14),r=n.n(s),c=n(39),o=n(35),u=n(15),l=n(18),h=n.n(l),d=n(24),f=n(5),b=n(34),j=n(23),v=n(36),w=n.n(v),O=n(37),g=n.n(O),p=n(10),m=n.n(p),x=(n(48),n(25)),k=n(26),y=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Object(x.a)(this,e),this.state=void 0,this.callbacks=void 0,this.state=t,this.callbacks=n?[n]:[]}return Object(k.a)(e,[{key:"useState",value:function(){var e=this,t=Object(a.useState)(this.state),n=Object(f.a)(t,2),i=n[0],s=n[1];return-1===this.callbacks.indexOf(s)&&this.onChange(s),Object(a.useEffect)((function(){return function(){return e.deRegister(s)}}),[]),[i,this.set.bind(this)]}},{key:"onChange",value:function(e){this.callbacks.push(e)}},{key:"deRegister",value:function(e){this.callbacks.splice(this.callbacks.indexOf(e),1)}},{key:"set",value:function(e){this.state=e;var t,n=Object(u.a)(this.callbacks);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(i){n.e(i)}finally{n.f()}}}]),e}(),S=function(){function e(t){var n=this;Object(x.a)(this,e),this.waitingOnButton=void 0,this.sendPhotoFunc=void 0,this.imuData=void 0,this.imuQuaternion=void 0,this.ws=void 0,this.ws=t,this.waitingOnButton=new y(!1),this.sendPhotoFunc=new y(null),this.imuData=new y([[Math.floor(Date.now()/1e3)],[0],[0],[0]]),this.imuQuaternion=new y(null),t.onmessage=function(){var e=Object(d.a)(h.a.mark((function e(t){var i;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.data,e.abrupt("return",n.onMsg(JSON.parse(i)));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}return Object(k.a)(e,[{key:"onMsg",value:function(e){var t=this;switch(e.cmd){case"grab":if(e.button)this.waitingOnButton.set(!0);else if(null!==this.sendPhotoFunc.state)this.sendPhotoFunc.state();else{this.sendPhotoFunc.onChange((function e(n){n(),t.sendPhotoFunc.deRegister(e)}))}break;case"imu":this.send(this.imuQuaternion.state);break;case"disconnect":throw this.ws.close(),new Error("Another client device has taken control of websocket");default:throw new Error("Unhandled Api message ".concat(e))}}},{key:"send",value:function(e){this.ws.send(e instanceof Blob?e:JSON.stringify(e))}}]),e}();S.WS_URL="wss://"+document.domain+":"+window.location.port+"/ws";var E=n(40),R=n(38);n(49);function D(e){var t=e.scope,n=t.data.useState(),s=Object(f.a)(n,1)[0],r=Object(a.useRef)(null),c=Object(a.useRef)();return Object(a.useEffect)((function(){var e=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],n=r.current;if(c.current)c.current.setData(s);else if(n&&!c.current){var i,a=c.current=new R.a({width:600,height:400,series:[{}].concat(Object(E.a)((null!==(i=t.labels)&&void 0!==i?i:[]).map((function(t,n){return{label:t,stroke:e[n%e.length],points:{show:!1}}})))),axes:[{stroke:"white",labelSize:0,grid:{stroke:"white",width:.1},ticks:{show:!1,size:0},size:0,values:""},{stroke:"white",grid:{stroke:"white",width:.1},ticks:{show:!1}}]},s,n),o=m()(n.parentElement);new ResizeObserver((function(){a.setSize({width:o.offsetWidth,height:o.offsetHeight-25})})).observe(o)}}),[r,s,t.labels]),Object(i.jsx)("div",{ref:r})}function C(e){var t=e.api,n=Object(a.useRef)(null),s=Object(a.useRef)(null),r=t.waitingOnButton.useState(),c=Object(f.a)(r,2),o=c[0],l=c[1],v=Object(a.useState)(!0),O=Object(f.a)(v,2),p=O[0],x=O[1],k=Object(a.useState)(!1),y=Object(f.a)(k,2),S=y[0],E=y[1],R=Object(a.useCallback)((function(){var e=m()(s.current),i=m()(n.current);l(!1);var a=e.width=i.videoWidth,r=e.height=i.videoHeight,c=m()(e.getContext("2d"));c.drawImage(i,0,0);var o=c.getImageData(0,0,a,r).data.filter((function(e,t){return t%4!==3}));t.send(new Blob([new Uint16Array([a,r]),o]))}),[t,l]);return Object(a.useEffect)((function(){var e=m()(n.current);!function(){var t=Object(d.a)(h.a.mark((function t(){return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({video:{width:{min:1280,ideal:1920,max:2560},height:{min:720,ideal:1080,max:1440}}});case 2:e.srcObject=t.sent;case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),e.onloadeddata=function(){return t.sendPhotoFunc.set(R)}}),[t,R]),Object(a.useEffect)((function(){var e=function(e){var n=e.alpha,i=e.beta,a=e.gamma,s=Date.now()/1e3,r=t.imuData.state;r[0].push(s),r[1].push(n),r[2].push(i),r[3].push(a);var c=Object(f.a)(r,1)[0],o=s-5,l=c.findIndex((function(e){return e>=o}));if(l>0){var h,d=Object(u.a)(r);try{for(d.s();!(h=d.n()).done;){h.value.splice(0,l)}}catch(v){d.e(v)}finally{d.f()}}var b=Math.PI/180,j=g.a.fromEuler(m()(n)*b,m()(i)*b,m()(a)*b);t.imuData.set(r.slice()),t.imuQuaternion.set(j)};return window.addEventListener("deviceorientation",e),function(){return window.removeEventListener("deviceorientation",e)}}),[t.imuData,t.imuQuaternion]),Object(i.jsxs)("div",{style:{width:"100vw",height:"100vh",position:"relative",display:"flex"},children:[Object(i.jsx)("video",{ref:n,autoPlay:!0,style:{maxWidth:"100%",maxHeight:"100%",margin:"0 auto"}}),Object(i.jsx)("canvas",{ref:s,style:{display:"none"}}),Object(i.jsxs)("div",{style:{position:"absolute",top:0,display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",width:"100%"},children:[Object(i.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"start",margin:20},children:[p?Object(i.jsx)("div",{style:{height:100,width:"100%",color:"white",background:"#282c34",borderRadius:5},children:Object(i.jsx)(D,{scope:{name:"Orientation",styles:null,labels:["alpha","beta","gamma"],data:t.imuData,keepLastSecs:5}})}):null,Object(i.jsx)(b.a,{variant:"outline-light",style:{borderRadius:99,height:60,width:60,fontSize:32,margin:10},onClick:function(){return E(!0)},children:"\u22ef"}),Object(i.jsxs)(j.a,{show:S,onHide:function(){return E(!1)},size:"lg",children:[Object(i.jsx)(j.a.Header,{closeButton:!0,children:Object(i.jsx)(j.a.Title,{children:"Menu"})}),Object(i.jsx)(j.a.Body,{children:Object(i.jsxs)("label",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:"1rem"},children:["Show IMU Data?",Object(i.jsx)(w.a,{onChange:x,checked:p,height:30,width:60})]})})]})]}),o?Object(i.jsx)(b.a,{variant:"outline-light",style:{borderRadius:99,height:90,width:90,fontSize:32,margin:10,alignSelf:"center"},disabled:!o,onClick:R,children:"\ud83d\udcf7"}):null]})]})}function B(){var e=function(){var e=Object(a.useState)(null),t=Object(f.a)(e,2),n=t[0],i=t[1];return Object(a.useEffect)((function(){var e=new WebSocket(S.WS_URL);return e.onopen=function(){return i(new S(e))},e.onclose=function(){return i(null)},e.onerror=function(e){return i(new Error("couldn't connect to ws api @ ".concat(S.WS_URL)))},e.close}),[]),n}();if(e instanceof Error)throw e;return e?Object(i.jsx)(C,{api:e}):null}n(53);r.a.render(Object(i.jsx)(c.ErrorBoundary,{fallbackRender:function(e){var t=e.error,n=e.resetErrorBoundary;return Object(i.jsxs)(o.a,{variant:"danger",children:["Something went wrong:",t.toString(),Object(i.jsx)("br",{}),Object(i.jsx)(o.a.Link,{onClick:n,children:"Try again"})]})},children:Object(i.jsx)(B,{})}),document.getElementById("root"))}},[[54,1,2]]]);
//# sourceMappingURL=main.4532d766.chunk.js.map