(this["webpackJsonpmvt-phonesensor-app"]=this["webpackJsonpmvt-phonesensor-app"]||[]).push([[0],{56:function(e,t,n){"use strict";n.r(t);var a=n(3),r=n(0),i=n(15),s=n.n(i),o=n(41),c=n(37),u=n(16),l=n(26),h=n(24),d=n(10),f=n.n(d),b=n(22),v=n(5),j=n(36),w=n(25),m=n(38),p=n.n(m),O=n(39),g=n.n(O),x=n(11),y=n.n(x),k=(n(50),n(27)),S=n(28),D=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Object(k.a)(this,e),this.state=void 0,this.callbacks=void 0,this.state=t,this.callbacks=n?[n]:[]}return Object(S.a)(e,[{key:"useState",value:function(){var e=this,t=Object(r.useState)(this.state),n=Object(v.a)(t,2),a=n[0],i=n[1];return-1===this.callbacks.indexOf(i)&&this.onChange(i),Object(r.useEffect)((function(){return function(){return e.deRegister(i)}}),[]),[a,this.set.bind(this)]}},{key:"onChange",value:function(e){this.callbacks.push(e)}},{key:"deRegister",value:function(e){this.callbacks.splice(this.callbacks.indexOf(e),1)}},{key:"set",value:function(e){this.state=e;var t,n=Object(u.a)(this.callbacks);try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(a){n.e(a)}finally{n.f()}}}]),e}(),E=function(){function e(t){var n=this;Object(k.a)(this,e),this.waitingOnButton=void 0,this.sendPhotoFunc=void 0,this.imuQuaternionData=void 0,this.imuDataFrame=void 0,this.ws=void 0,this.ws=t,this.waitingOnButton=new D(!1),this.sendPhotoFunc=new D(null),this.imuQuaternionData=new D([[Math.floor(Date.now()/1e3)],[0],[0],[0]]),this.imuDataFrame=new D({error:"No IMU data is available. The device either does not support IMU data or has not been given permission."},(function(e){"error"in e&&delete e.error})),t.onmessage=function(){var e=Object(b.a)(f.a.mark((function e(t){var a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.data,e.abrupt("return",n.onMsg(JSON.parse(a)));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}return Object(S.a)(e,[{key:"onMsg",value:function(e){var t=this;switch(e.cmd){case"grab":if(e.button)this.waitingOnButton.set(!0);else if(null!==this.sendPhotoFunc.state)this.sendPhotoFunc.state();else{this.sendPhotoFunc.onChange((function e(n){n(),t.sendPhotoFunc.deRegister(e)}))}break;case"imu":this.send(this.imuDataFrame.state);break;case"disconnect":throw this.ws.close(),new Error("Another client device has taken control of websocket");default:throw new Error("Unhandled Api message ".concat(e))}}},{key:"send",value:function(e){this.ws.send(e instanceof Blob?e:JSON.stringify(e))}}]),e}();E.WS_URL="wss://"+document.domain+":"+window.location.port+"/ws";var R=n(42),F=n(40);n(51);function C(e){var t=e.scope,n=t.data.useState(),i=Object(v.a)(n,1)[0],s=Object(r.useRef)(null),o=Object(r.useRef)();return Object(r.useEffect)((function(){var e=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],n=s.current;if(o.current)o.current.setData(i);else if(n&&!o.current){var a,r=o.current=new F.a({width:600,height:400,series:[{}].concat(Object(R.a)((null!==(a=t.labels)&&void 0!==a?a:[]).map((function(t,n){return{label:t,stroke:e[n%e.length],points:{show:!1}}})))),axes:[{stroke:"white",labelSize:0,grid:{stroke:"white",width:.1},ticks:{show:!1,size:0},size:0,values:""},{stroke:"white",grid:{stroke:"white",width:.1},ticks:{show:!1}}]},i,n),c=y()(n.parentElement);new ResizeObserver((function(){r.setSize({width:c.offsetWidth,height:c.offsetHeight-25})})).observe(c)}}),[s,i,t.labels]),Object(a.jsx)("div",{ref:s})}function z(e){var t=e.api,n=Object(r.useRef)(null),i=Object(r.useRef)(null),s=t.waitingOnButton.useState(),o=Object(v.a)(s,2),c=o[0],d=o[1],m=Object(r.useState)(!1),O=Object(v.a)(m,2),x=O[0],k=O[1],S=Object(r.useState)(!1),D=Object(v.a)(S,2),E=D[0],R=D[1],F=Object(r.useCallback)((function(){var e=y()(i.current),a=y()(n.current);d(!1);var r=e.width=a.videoWidth,s=e.height=a.videoHeight,o=y()(e.getContext("2d"));o.drawImage(a,0,0);var c=o.getImageData(0,0,r,s).data.filter((function(e,t){return t%4!==3}));t.send(new Blob([new Uint16Array([r,s]),c]))}),[t,d]);return Object(r.useEffect)((function(){var e=y()(n.current);!function(){var t=Object(b.a)(f.a.mark((function t(){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,navigator.mediaDevices.getUserMedia({video:{width:{min:1280,ideal:1920,max:2560},height:{min:720,ideal:1080,max:1440}}});case 2:e.srcObject=t.sent;case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()(),e.onloadeddata=function(){return t.sendPhotoFunc.set(F)}}),[t,F]),Object(r.useEffect)((function(){!function(){var e=Object(b.a)(f.a.mark((function e(){var n,a,r,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n={accelerometer:Accelerometer,gyroscope:Gyroscope,magnetometer:Magnetometer},a=f.a.mark((function e(){var n,a,s,o;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Object(v.a)(i[r],2),a=n[0],"function"!=typeof(s=n[1])){e.next=8;break}return e.next=4,navigator.permissions.query({name:a});case 4:(o=new s({frequency:30})).addEventListener("error",(function(e){"NotAllowedError"===e.error.name||("NotReadableError"===e.error.name?console.error("Cannot connect to the sensor."):t.imuDataFrame.set(Object(h.a)(Object(h.a)({},t.imuDataFrame.state),{},Object(l.a)({},a,[o.x,o.y,o.z]))))})),o.addEventListener("reading",(function(){})),o.start();case 8:case"end":return e.stop()}}),e)})),r=0,i=Object.entries(n);case 4:if(!(r<i.length)){e.next=9;break}return e.delegateYield(a(),"t0",6);case 6:r++,e.next=4;break;case 9:e.next=22;break;case 11:if(e.prev=11,e.t1=e.catch(0),"SecurityError"!==e.t1.name){e.next=17;break}console.error("Sensor construction was blocked by a feature policy."),e.next=22;break;case 17:if("ReferenceError"!==e.t1.name){e.next=21;break}console.error("Sensor is not supported by the User Agent."),e.next=22;break;case 21:throw e.t1;case 22:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}()();var e=function(e){var n=e.alpha,a=e.beta,r=e.gamma,i=Date.now()/1e3,s=t.imuQuaternionData.state;s[0].push(i),s[1].push(n),s[2].push(a),s[3].push(r);var o=Object(v.a)(s,1)[0],c=i-5,l=o.findIndex((function(e){return e>=c}));if(l>0){var d,f=Object(u.a)(s);try{for(f.s();!(d=f.n()).done;){d.value.splice(0,l)}}catch(w){f.e(w)}finally{f.f()}}var b=Math.PI/180,j=g.a.fromEuler(y()(n)*b,y()(a)*b,y()(r)*b);t.imuQuaternionData.set(s.slice()),t.imuDataFrame.set(Object(h.a)(Object(h.a)({},t.imuDataFrame.state),{},{quaternion:[j.x,j.y,j.z,j.w]}))};return window.addEventListener("deviceorientation",e),function(){return window.removeEventListener("deviceorientation",e)}}),[t.imuQuaternionData,t.imuDataFrame]),Object(a.jsxs)("div",{style:{width:"100vw",height:"100vh",position:"relative",display:"flex"},children:[Object(a.jsx)("video",{ref:n,autoPlay:!0,style:{maxWidth:"100%",maxHeight:"100%",margin:"0 auto"}}),Object(a.jsx)("canvas",{ref:i,style:{display:"none"}}),Object(a.jsxs)("div",{style:{position:"absolute",top:0,display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",width:"100%"},children:[Object(a.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",alignItems:"start",margin:20},children:[x?Object(a.jsx)("div",{style:{height:100,width:"100%",color:"white",background:"#282c34",borderRadius:5},children:Object(a.jsx)(C,{scope:{name:"Orientation",styles:null,labels:["alpha","beta","gamma"],data:t.imuQuaternionData,keepLastSecs:5}})}):null,Object(a.jsx)(j.a,{variant:"outline-light",style:{borderRadius:99,height:60,width:60,fontSize:32,margin:10},onClick:function(){return R(!0)},children:"\u22ef"}),Object(a.jsxs)(w.a,{show:E,onHide:function(){return R(!1)},size:"lg",children:[Object(a.jsx)(w.a.Header,{closeButton:!0,children:Object(a.jsx)(w.a.Title,{children:"Menu"})}),Object(a.jsx)(w.a.Body,{children:Object(a.jsxs)("label",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:"1rem"},children:["Show IMU Data?",Object(a.jsx)(p.a,{onChange:k,checked:x,height:30,width:60})]})})]})]}),c?Object(a.jsx)(j.a,{variant:"outline-light",style:{borderRadius:99,height:90,width:90,fontSize:32,margin:10,alignSelf:"center"},disabled:!c,onClick:F,children:"\ud83d\udcf7"}):null]})]})}function B(){var e=function(){var e=Object(r.useState)(null),t=Object(v.a)(e,2),n=t[0],a=t[1];return Object(r.useEffect)((function(){var e=new WebSocket(E.WS_URL);return e.onopen=function(){return a(new E(e))},e.onclose=function(){return a(null)},e.onerror=function(e){return a(new Error("couldn't connect to ws api @ ".concat(E.WS_URL)))},e.close}),[]),n}();if(e instanceof Error)throw e;return e?Object(a.jsx)(z,{api:e}):null}n(55);s.a.render(Object(a.jsx)(o.ErrorBoundary,{fallbackRender:function(e){var t=e.error,n=e.resetErrorBoundary;return Object(a.jsxs)(c.a,{variant:"danger",children:["Something went wrong:",t.toString(),Object(a.jsx)("br",{}),Object(a.jsx)(c.a.Link,{onClick:n,children:"Try again"})]})},children:Object(a.jsx)(B,{})}),document.getElementById("root"))}},[[56,1,2]]]);
//# sourceMappingURL=main.885284ec.chunk.js.map