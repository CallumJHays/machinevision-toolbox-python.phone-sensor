{"version":3,"sources":["observable.ts","api.ts","SignalScopeChart.tsx","App.tsx","index.tsx"],"names":["Observable","init","onChange","state","callbacks","this","useState","setState","indexOf","useEffect","deRegister","set","bind","cb","push","splice","Api","ws","waitingOnButton","sendPhotoFunc","imuData","imuQuaternion","Math","floor","Date","now","onmessage","a","data","onMsg","JSON","parse","msg","cmd","button","sendPhoto","send","close","Error","Blob","stringify","WS_URL","document","domain","window","location","port","SignalScopeChart","scope","containerRef","useRef","chartRef","VEGA_CAT_10_COLORS","container","current","setData","uplot","uPlot","width","height","series","labels","map","label","i","stroke","length","points","show","axes","labelSize","grid","ticks","size","values","parent","unwrap","parentElement","ResizeObserver","setSize","offsetWidth","offsetHeight","observe","ref","MainUI","api","videoRef","canvasRef","waitingForButton","setWaitingForButton","showImuData","setShowImuData","showMenu","setShowMenu","useCallback","canvas","video","w","videoWidth","h","videoHeight","ctx","getContext","drawImage","img","getImageData","filter","_","idx","Uint16Array","navigator","mediaDevices","getUserMedia","min","ideal","max","srcObject","onloadeddata","imuCallback","alpha","beta","gamma","time","cutoffTime","cutoffIdx","findIndex","t","RAD","PI","quaternion","Quaternion","fromEuler","slice","addEventListener","removeEventListener","style","position","display","autoPlay","maxWidth","maxHeight","margin","top","flexDirection","justifyContent","alignItems","color","background","borderRadius","name","styles","keepLastSecs","Button","variant","fontSize","onClick","Modal","onHide","Header","closeButton","Title","Body","checked","alignSelf","disabled","App","setApi","WebSocket","onopen","onclose","onerror","e","useApi","ReactDOM","render","fallbackRender","error","resetErrorBoundary","Alert","toString","Link","getElementById"],"mappings":"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","file":"static/js/main.4532d766.chunk.js","sourcesContent":["import { useState, useEffect } from \"react\";\n\ntype Callback<T> = (state: T) => void;\n\n// something neat I came up with - similar to https://github.com/pmndrs/valtio\nexport class Observable<T> {\n  state: T;\n  callbacks: Callback<T>[];\n\n  constructor(init: T, onChange: Callback<T> | null = null) {\n    this.state = init;\n    this.callbacks = onChange ? [onChange] : [];\n  }\n\n  // register with react lifecycle\n  useState(): [T, (state: T) => void] {\n    const [state, setState] = useState<T>(this.state); // eslint-disable-line\n\n    // this would usually be in the useEffect below, but for compatability with the\n    // component lifecycle we need this to be called here\n    if (this.callbacks.indexOf(setState) === -1) {\n      this.onChange(setState);\n    }\n\n    // eslint-disable-next-line\n    useEffect(() => {\n      return () => this.deRegister(setState);\n    }, []);\n\n    return [state, this.set.bind(this)];\n  }\n\n  onChange(cb: Callback<T>) {\n    this.callbacks.push(cb);\n  }\n\n  deRegister(cb: Callback<T>) {\n    this.callbacks.splice(this.callbacks.indexOf(cb), 1);\n  }\n\n  set(state: T) {\n    this.state = state;\n    for (const cb of this.callbacks) {\n      cb(state);\n    }\n  }\n}\n","import Quaternion from \"quaternion\";\nimport { useState, useEffect } from \"react\";\nimport { Observable } from \"./observable\";\n\ntype CameraGrabApiMsg = {\n  cmd: \"grab\";\n  cam: string;\n  button: boolean;\n  wait: number | null;\n};\n\ntype ImuApiMsg = {\n  cmd: \"imu\";\n  wait: number | null;\n};\n\ntype ServerDisconnectMsg = {\n  cmd: \"disconnect\"; // occurs when a second client attempts to connect - switches to newest\n};\n\ntype ApiMsg = CameraGrabApiMsg | ImuApiMsg | ServerDisconnectMsg;\n\nexport class Api {\n  waitingOnButton: Observable<boolean>;\n  sendPhotoFunc: Observable<(() => void) | null>;\n  imuData: Observable<number[][]>;\n  imuQuaternion: Observable<Quaternion | null>;\n\n  private ws: WebSocket;\n\n  // can't just use \"/ws\". WebSocket constructor won't accept it.\n  static WS_URL =\n    \"wss://\" + document.domain + \":\" + window.location.port + \"/ws\";\n\n  constructor(ws: WebSocket) {\n    this.ws = ws;\n    this.waitingOnButton = new Observable(false as boolean);\n    this.sendPhotoFunc = new Observable(null as any);\n    this.imuData = new Observable([\n      [Math.floor(Date.now() / 1000)],\n      [0],\n      [0],\n      [0],\n    ]);\n    this.imuQuaternion = new Observable(null as any);\n\n    ws.onmessage = async ({ data }: { data: string }) =>\n      this.onMsg(JSON.parse(data) as ApiMsg);\n  }\n\n  private onMsg(msg: ApiMsg) {\n    switch (msg.cmd) {\n      case \"grab\":\n        if (msg.button) {\n          this.waitingOnButton.set(true);\n        } else if (this.sendPhotoFunc.state !== null) {\n          this.sendPhotoFunc.state();\n        } else {\n          const cb = (sendPhoto: (() => void) | null) => {\n            sendPhoto!();\n            this.sendPhotoFunc.deRegister(cb);\n          };\n          this.sendPhotoFunc.onChange(cb);\n        }\n        break;\n\n      case \"imu\":\n        this.send(this.imuQuaternion.state);\n        break;\n\n      case \"disconnect\":\n        this.ws.close();\n        throw new Error(\"Another client device has taken control of websocket\");\n\n      default:\n        throw new Error(`Unhandled Api message ${msg}`);\n    }\n  }\n\n  send(msg: any) {\n    this.ws.send(msg instanceof Blob ? msg : JSON.stringify(msg));\n  }\n}\n\nexport function useApi() {\n  // params: ConstructorParameters<typeof Api> ) {\n  const [api, setApi] = useState<Api | null | Error>(null);\n\n  useEffect(() => {\n    const ws = new WebSocket(Api.WS_URL);\n    ws.onopen = () => setApi(new Api(ws)); //, params));\n    ws.onclose = () => setApi(null);\n    ws.onerror = (e) =>\n      setApi(new Error(`couldn't connect to ws api @ ${Api.WS_URL}`));\n    return ws.close; // effect cleanup handler\n  }, []); //[params]);\n\n  return api;\n}\n","import React, { useEffect, useRef } from \"react\";\nimport uPlot from \"uplot\";\nimport { Observable } from \"./observable\";\nimport unwrap from \"ts-unwrap\";\nimport \"uplot/dist/uPlot.min.css\";\n\nexport type SignalScope = {\n  name: string;\n  styles: string | {} | null;\n  labels: string[] | null;\n  data: Observable<number[][]>;\n\n  // millliseconds of data to retain and display -\n  // prevents memory usage from growing indefinitely\n  keepLastSecs: number;\n};\n\nexport function SignalScopeChart({ scope }: { scope: SignalScope }) {\n  const [data] = scope.data.useState();\n  const containerRef = useRef<HTMLDivElement>(null);\n  const chartRef = useRef<uPlot>();\n\n  // update the chart\n  useEffect(() => {\n    // use the same modern matplotlib default colours\n    const VEGA_CAT_10_COLORS = [\n      \"#1f77b4\",\n      \"#ff7f0e\",\n      \"#2ca02c\",\n      \"#d62728\",\n      \"#9467bd\",\n      \"#8c564b\",\n      \"#e377c2\",\n      \"#7f7f7f\",\n      \"#bcbd22\",\n      \"#17becf\",\n    ];\n\n    const container = containerRef.current;\n    if (chartRef.current) {\n      chartRef.current.setData(data as any);\n      //   console.log(\"setData\", data);\n    } else if (container && !chartRef.current) {\n      const uplot = (chartRef.current = new uPlot(\n        {\n          width: 600,\n          height: 400,\n\n          series: [\n            {},\n            ...(scope.labels ?? []).map((label, i) => ({\n              label,\n              stroke: VEGA_CAT_10_COLORS[i % VEGA_CAT_10_COLORS.length],\n              points: { show: false },\n            })),\n          ],\n\n          axes: [\n            {\n              stroke: \"white\",\n              labelSize: 0,\n              grid: { stroke: \"white\", width: 0.1 },\n              ticks: { show: false, size: 0 },\n              size: 0,\n              values: \"\",\n            },\n            {\n              stroke: \"white\",\n              grid: { stroke: \"white\", width: 0.1 },\n              ticks: { show: false },\n            },\n          ],\n        },\n        data as any, // uPlot.js types incorrect here\n        container\n      ));\n      const parent = unwrap(container.parentElement);\n\n      new ResizeObserver(() => {\n        const LEGEND_HEIGHT = 25;\n        uplot.setSize({\n          width: parent.offsetWidth,\n          height: parent.offsetHeight - LEGEND_HEIGHT,\n        });\n      }).observe(parent);\n    }\n  }, [containerRef, data, scope.labels]);\n\n  return <div ref={containerRef} />;\n}\n","import { useEffect, useRef, useCallback, useState } from \"react\";\nimport Button from \"react-bootstrap/Button\";\nimport Modal from \"react-bootstrap/Modal\";\nimport Switch from \"react-switch\";\nimport Quaternion from \"quaternion\";\nimport unwrap from \"ts-unwrap\";\nimport \"md-gum-polyfill\"; // get videostream working on more browsers\n\nimport { useApi, Api } from \"./api\";\nimport { SignalScopeChart } from \"./SignalScopeChart\";\n\nconst KEEP_LAST_SECS_IMU_DATA = 5;\n\nfunction MainUI({ api }: { api: Api }) {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const [\n    waitingForButton,\n    setWaitingForButton,\n  ] = api.waitingOnButton.useState();\n  const [showImuData, setShowImuData] = useState(true);\n  const [showMenu, setShowMenu] = useState(false);\n\n  const sendPhoto = useCallback(\n    function sendPhoto() {\n      const canvas = unwrap(canvasRef.current);\n      const video = unwrap(videoRef.current);\n      setWaitingForButton(false);\n\n      const w = (canvas.width = video.videoWidth);\n      const h = (canvas.height = video.videoHeight);\n      const ctx = unwrap(canvas.getContext(\"2d\"));\n      ctx.drawImage(video, 0, 0);\n      const img = ctx\n        .getImageData(0, 0, w, h)\n        // discard the alpha channel by skipping every 4th byte\n        .data.filter((_, idx) => idx % 4 !== 3);\n      api.send(new Blob([new Uint16Array([w, h]), img]));\n    },\n    [api, setWaitingForButton]\n  );\n\n  useEffect(() => {\n    const video = unwrap(videoRef.current);\n\n    (async function startLiveStream() {\n      video.srcObject = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: {\n            min: 1280,\n            ideal: 1920,\n            max: 2560,\n          },\n\n          height: {\n            min: 720,\n            ideal: 1080,\n            max: 1440,\n          },\n        },\n      });\n    })();\n\n    // wait for the first frame to load before letting api know we're good to send photos\n    video.onloadeddata = () => api.sendPhotoFunc.set(sendPhoto);\n\n    // don't bother with cleanup for now\n  }, [api, sendPhoto]);\n\n  useEffect(() => {\n    const imuCallback = ({ alpha, beta, gamma }: DeviceOrientationEvent) => {\n      // append the data\n      const now = Date.now() / 1000;\n      const data = api.imuData.state;\n      data[0].push(now);\n      data[1].push(alpha!);\n      data[2].push(beta!);\n      data[3].push(gamma!);\n\n      // only keep scope.keepLastSecs worth of data\n      const [time] = data;\n      const cutoffTime = now - KEEP_LAST_SECS_IMU_DATA;\n      const cutoffIdx = time.findIndex((t) => t >= cutoffTime);\n      if (cutoffIdx > 0) {\n        for (const series of data) {\n          series.splice(0, cutoffIdx);\n        }\n      }\n\n      // Update the rotation object\n      const RAD = Math.PI / 180;\n      const quaternion = Quaternion.fromEuler(\n        unwrap(alpha) * RAD,\n        unwrap(beta) * RAD,\n        unwrap(gamma) * RAD\n      );\n\n      // [OPTIONAL IMPROVEMENT]: Display orientation via a rotating mobile phone image\n      // Set the CSS style to the element you want to rotate\n      // elm.style.transform = \"matrix3d(\" + q.conjugate().toMatrix4() + \")\";\n\n      // update the observable\n      api.imuData.set(data.slice());\n      api.imuQuaternion.set(quaternion);\n    };\n\n    window.addEventListener(\"deviceorientation\", imuCallback);\n    return () => window.removeEventListener(\"deviceorientation\", imuCallback);\n  }, [api.imuData, api.imuQuaternion]);\n\n  return (\n    <div\n      style={{\n        width: \"100vw\",\n        height: \"100vh\",\n        position: \"relative\",\n        display: \"flex\",\n      }}\n    >\n      <video\n        ref={videoRef}\n        autoPlay\n        style={{ maxWidth: \"100%\", maxHeight: \"100%\", margin: \"0 auto\" }}\n      />\n      {/* canvas required for screenshot (MediaStreamCapture API not available in most mobile browsers) */}\n      <canvas ref={canvasRef} style={{ display: \"none\" }} />\n\n      <div\n        style={{\n          position: \"absolute\",\n          top: 0,\n          display: \"flex\",\n          flexDirection: \"column\",\n          justifyContent: \"space-between\",\n          height: \"100%\",\n          width: \"100%\",\n        }}\n      >\n        <div\n          style={{\n            display: \"flex\",\n            justifyContent: \"flex-end\",\n            alignItems: \"start\",\n            margin: 20,\n          }}\n        >\n          {showImuData ? (\n            <div\n              style={{\n                height: 100,\n                width: \"100%\",\n                color: \"white\",\n                background: \"#282c34\",\n                borderRadius: 5,\n              }}\n            >\n              <SignalScopeChart\n                scope={{\n                  name: \"Orientation\",\n                  styles: null,\n                  labels: [\"alpha\", \"beta\", \"gamma\"],\n                  data: api.imuData,\n                  keepLastSecs: 5,\n                }}\n              />\n              {/* Has some graphical bugs. Leaving here incase it wants to be developed in the future */}\n              {/* <SignalBarChart\n                data={api.imuData}\n                labels={[\"alpha\", \"beta\", \"gamma\"]}\n              /> */}\n            </div>\n          ) : null}\n\n          <Button\n            variant=\"outline-light\"\n            style={{\n              borderRadius: 99,\n              height: 60,\n              width: 60,\n              fontSize: 32,\n              margin: 10,\n            }}\n            onClick={() => setShowMenu(true)}\n          >\n            ⋯\n          </Button>\n\n          <Modal show={showMenu} onHide={() => setShowMenu(false)} size=\"lg\">\n            <Modal.Header closeButton>\n              <Modal.Title>Menu</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n              <label\n                style={{\n                  display: \"flex\",\n                  flexDirection: \"row\",\n                  justifyContent: \"space-between\",\n                  alignItems: \"center\",\n                  fontSize: \"1rem\",\n                }}\n              >\n                Show IMU Data?\n                <Switch\n                  onChange={setShowImuData}\n                  checked={showImuData}\n                  height={30}\n                  width={60}\n                />\n              </label>\n            </Modal.Body>\n          </Modal>\n        </div>\n\n        {waitingForButton ? (\n          <Button\n            variant=\"outline-light\"\n            style={{\n              borderRadius: 99,\n              height: 90,\n              width: 90,\n              fontSize: 32,\n              margin: 10,\n              alignSelf: \"center\",\n            }}\n            disabled={!waitingForButton}\n            onClick={sendPhoto}\n          >\n            📷\n          </Button>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n\nexport default function App() {\n  const api = useApi();\n\n  if (api instanceof Error) {\n    throw api; // get handle'd by error boundary in index.tsx\n  }\n\n  return api ? <MainUI api={api} /> : null;\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { ErrorBoundary } from \"react-error-boundary\";\nimport Alert from \"react-bootstrap/Alert\";\n\nimport App from \"./App\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\n\nReactDOM.render(\n  <ErrorBoundary\n    fallbackRender={({ error, resetErrorBoundary }) => (\n      <Alert variant=\"danger\">\n        Something went wrong:\n        {error.toString()}\n        <br />\n        <Alert.Link onClick={resetErrorBoundary}>Try again</Alert.Link>\n      </Alert>\n    )}\n  >\n    <App />\n  </ErrorBoundary>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}